# Kōan Configuration

# Paths
project_path: "/path/to/anantys-back"  # Target project to analyze
pilot_repo: "/path/to/koan"            # This repo

# Budget & Scheduling
max_runs_per_day: 20
interval_seconds: 300  # 5 minutes between runs

# Fast reply mode — use lightweight model (Haiku) for command handlers
# When true, /usage, /sparring, and similar commands use Haiku instead of default model
# Faster response, lower cost, but simpler answers
fast_reply: false

# Contemplative mode trigger chance (0-100%)
# When no mission is pending, this is the probability of running a reflective
# session instead of autonomous work. Allows regular moments of introspection
# without waiting for budget exhaustion.
# 0 = never contemplative, 10 = ~1 in 10 runs, 20 = ~1 in 5 runs
contemplative_chance: 10

# Telegram
telegram:
  bot_token: "YOUR_BOT_TOKEN"  # From @BotFather
  chat_id: "YOUR_CHAT_ID"     # From first message to bot

# Usage thresholds
budget:
  warn_at_percent: 70   # Send warning via Telegram
  stop_at_percent: 85   # Stop running

# Claude tools configuration
# These tools will be available when Claude is invoked for chat responses
tools:
  allowed: ["Read", "Glob", "Grep", "Edit", "Write", "Bash"]
  description: |
    Available capabilities:
    - File operations: Read, Edit, Write files in the project
    - Search: Glob (find files), Grep (search content)
    - Shell: Bash (run git, gh, make, and other commands)

# Claude model configuration
# Controls which models are used for different types of Claude calls
# Empty string = use default model (subscription default or ANTHROPIC_MODEL)
models:
  mission: ""              # Main mission execution (empty = default)
  chat: ""                 # Telegram/dashboard chat responses
  lightweight: "haiku"     # Low-cost calls: format_outbox, pick_mission, contemplative
  fallback: "sonnet"       # Fallback when primary model is overloaded (print mode only)
  review_mode: ""          # Override model for REVIEW mode (cheaper audits)

# Git auto-merge configuration
# Automatically merges koan/* branches based on rules
git_auto_merge:
  enabled: false                    # Global on/off switch
  base_branch: "main"               # Default target branch for merges
  strategy: "squash"                # merge | squash | rebase
  rules:
    - pattern: "koan/*"             # Branch name pattern (glob-style)
      auto_merge: true              # Enable auto-merge for matching branches
      delete_after_merge: true      # Clean up branch after successful merge

# Usage estimation (auto-calibration from Claude JSON output)
# Tune these limits based on your Claude plan by comparing
# estimated % with actual /usage output in Claude CLI
usage:
  session_token_limit: 500000   # Tokens per 5h session window
  weekly_token_limit: 5000000   # Tokens per 7-day window

# Per-project overrides
# Override git_auto_merge settings for specific projects
projects:
  mysafeproject:
    git_auto_merge:
      enabled: true
      base_branch: "main"
      strategy: "squash"
